@{
    ViewData["Title"] = "Priority Queue";
}

<div class="container mt-5">
    <h2>Priority Queue</h2>
    <hr />

    <!--  Search Bar -->
    <form method="get" asp-action="PriorityQueue" class="mb-3">
        <div class="input-group">
            <input type="text" name="searchTerm" value="@ViewBag.SearchTerm" class="form-control" placeholder="Search requests..." />
            <input type="hidden" name="sortOrder" value="@ViewBag.SortOrder" />
            <button type="submit" class="btn btn-primary">Search</button>
            <a href="@Url.Action("PriorityQueue")" class="btn btn-secondary">Clear</a>
        </div>
    </form>

    <!-- Sort Toggle -->
    <div class="mb-3">
        @{
            var toggleSort = (ViewBag.SortOrder == "asc") ? "desc" : "asc";
            var buttonText = (ViewBag.SortOrder == "asc") ? "Sort: High → Low" : "Sort: Low → High";
        }
        <a href="@Url.Action("PriorityQueue", new { searchTerm = ViewBag.SearchTerm, sortOrder = toggleSort })"
           class="btn btn-outline-dark">
            @buttonText
        </a>
    </div>

    <!--  Table of Requests -->
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Status</th>
                <th>Priority</th>
                <th>Progress (%)</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>@item.Id</td>
                    <td>@item.Title</td>
                    <td>@item.Status</td>
                    <td>
                        @item.Priority
                        @if (item.Priority == 3)
                        {
                            <span class="badge bg-danger ms-1">High</span>
                        }
                        else if (item.Priority == 2)
                        {
                            <span class="badge bg-warning text-dark ms-1">Medium</span>
                        }
                        else
                        {
                            <span class="badge bg-success ms-1">Low</span>
                        }
                    </td>
                    <td>@item.Progress%</td>
                </tr>
            }
        </tbody>
    </table>
</div>
